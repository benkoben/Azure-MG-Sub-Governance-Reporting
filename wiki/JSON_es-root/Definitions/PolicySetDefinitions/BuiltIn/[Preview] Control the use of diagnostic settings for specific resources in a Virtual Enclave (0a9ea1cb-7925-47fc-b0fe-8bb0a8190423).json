{
  "displayName": "[Preview]: Control the use of diagnostic settings for specific resources in a Virtual Enclave",
  "policyType": "BuiltIn",
  "description": "This initiative deploys Azure policies to ensure configuration of specific resource types in Azure Virtual Enclaves. https://aka.ms/VirtualEnclaves",
  "metadata": {
    "version": "1.0.0-preview",
    "category": "VirtualEnclaves",
    "preview": true
  },
  "parameters": {
    "diagnosticSettingName": {
      "type": "String",
      "metadata": {
        "displayName": "Diagnostic Setting Name",
        "description": "Diagnostic Setting Name"
      },
      "defaultValue": "setByPolicy-LogAnalytics"
    },
    "logAnalytics": {
      "type": "String",
      "metadata": {
        "displayName": "Log Analytics Workspace",
        "description": "Log Analytics Workspace",
        "strongType": "omsWorkspace",
        "assignPermissions": true
      }
    }
  },
  "policyDefinitions": [
    {
      "policyDefinitionReferenceId": "AppServiceDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/c0d8e23a-47be-4032-961f-8b0ff3957061",
      "parameters": {
        "diagnosticSettingName": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "ApplicationGroupDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/3aa571d2-2e4f-4e92-8a30-4312860efbe1",
      "parameters": {
        "diagnosticSettingName": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "ApplicationInsightsDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/244bcb20-b194-41f3-afcc-63aef382b64c",
      "parameters": {
        "diagnosticSettingName": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "CosmosDbAccountsDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/45c6bfc7-4520-4d64-a158-730cd92eedbc",
      "parameters": {
        "diagnosticSettingName": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        },
        "categoryGroup": {
          "value": "allLogs"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "FirewallDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/a4490248-cb97-4504-b7fb-f906afdb7437",
      "parameters": {
        "diagnosticSettingName": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "FunctionAppDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/e9c22e0d-1f03-44da-a9d5-a9754ea53dc4",
      "parameters": {
        "diagnosticSettingName": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "HostPoolsDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/6f95136f-6544-4722-a354-25a18ddb18a7",
      "parameters": {
        "diagnosticSettingName": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "PostgreSqlFlexibleDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/cdd1dbc6-0004-4fcd-afd7-b67550de37ff",
      "parameters": {
        "diagnosticSettingName": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "WorkspacesDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/6bb23bce-54ea-4d3d-b07d-628ce0f2e4e3",
      "parameters": {
        "diagnosticSettingName": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "KeyVaultDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/bef3f64c-5290-43b7-85b0-9b254eef4c47",
      "parameters": {
        "profileName": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "LogicAppsDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/b889a06c-ec72-4b03-910a-cb169ee18721",
      "parameters": {
        "profileName": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "MSSqlDbDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/b79fa14e-238a-4c2d-b376-442ce508fc84",
      "parameters": {
        "diagnosticsSettingNameToUse": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "MSSqlDbServerDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/7ea8a143-05e3-4553-abfe-f56bef8b0b70",
      "parameters": {
        "logAnalyticsWorkspaceId": {
          "value": "[parameters('logAnalytics')]"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "PublicIpDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/1513498c-3091-461a-b321-e9b433218d28",
      "parameters": {
        "diagnosticSettingName": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        },
        "categoryGroup": {
          "value": "allLogs"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "StorageAccountDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/59759c62-9a22-4cdf-ae64-074495983fef",
      "parameters": {
        "profileName": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "BlobServicesDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/b4fe1a3b-0715-4c6c-a5ea-ffc33cf823cb",
      "parameters": {
        "profileName": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "FileServicesDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/25a70cc8-2bd4-47f1-90b6-1478e4662c96",
      "parameters": {
        "profileName": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "QueueServicesDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/7bd000e3-37c7-4928-9f31-86c4b77c5c45",
      "parameters": {
        "profileName": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "TableServicesDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/2fb86bf3-d221-43d1-96d1-2434af34eaa0",
      "parameters": {
        "profileName": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "ContainerServiceDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/6c66c325-74c8-42fd-a286-a74b0e2939d8",
      "parameters": {
        "diagnosticsSettingNameToUse": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "ContainerRegistryDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/56288eb2-4350-461d-9ece-2bb242269dce",
      "parameters": {
        "diagnosticSettingName": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        },
        "categoryGroup": {
          "value": "allLogs"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "LogAnalyticsWorkspacesDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/818719e5-1338-4776-9a9d-3c31e4df5986",
      "parameters": {
        "diagnosticSettingName": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        },
        "categoryGroup": {
          "value": "allLogs"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "MSSqlManagedInstanceDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/8fc4ca5f-6abc-4b30-9565-0bd91ac49420",
      "parameters": {
        "diagnosticSettingName": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        },
        "categoryGroup": {
          "value": "allLogs"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "NetworkSecurityGroupDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/98a2e215-5382-489e-bd29-32e7190a39ba",
      "parameters": {
        "diagnosticsSettingNameToUse": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        }
      }
    },
    {
      "policyDefinitionReferenceId": "ServiceBusDiagnosticSettingsConfigured",
      "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/0277b2d5-6e6f-4d97-9929-a5c4eab56fd7",
      "parameters": {
        "diagnosticSettingName": {
          "value": "[parameters('diagnosticSettingName')]"
        },
        "logAnalytics": {
          "value": "[parameters('logAnalytics')]"
        },
        "categoryGroup": {
          "value": "allLogs"
        }
      }
    }
  ]
}
